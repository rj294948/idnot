<!DOCTYPE html>
<html>
<head>
  <title>RJ Services Data Manager</title>
  <style>
    table { border-collapse: collapse; width: 100%; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background: #f2f2f2; }
    input { width: 90%; padding: 4px; }
    button { padding: 5px 10px; margin: 2px; }
  </style>
</head>
<body>
  <h2>RJ Services Data Manager</h2>

  <table id="dataTable">
    <thead>
      <tr>
        <th>ID</th>
        <th>Company Name</th>
        <th>Product</th>
        <th>Product Type</th>
        <th>Rate</th>
        <th>Description</th>
        <th>Contact</th>
        <th>Mail</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <h3>Add / Edit Data</h3>
  <form id="dataForm">
    <input type="hidden" id="rowId" />
    <input type="text" id="companyname" placeholder="Company Name" required />
    <input type="text" id="product" placeholder="Product" required />
    <input type="text" id="producttype" placeholder="Product Type" />
    <input type="number" id="rate" placeholder="Rate" />
    <input type="text" id="description" placeholder="Description" />
    <input type="text" id="contact" placeholder="Contact" />
    <input type="email" id="mail" placeholder="Mail" />
    <button type="submit">Save</button>
    <button type="button" onclick="clearForm()">Clear</button>
  </form>

  <script>
    // Load data on page load
    function loadData() {
      google.script.run.withSuccessHandler(renderTable).getAllData();
    }

    // Render table
    function renderTable(data) {
      const tbody = document.querySelector('#dataTable tbody');
      tbody.innerHTML = '';
      data.forEach((row, i) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${i+1}</td>
          <td>${row.companyname || ''}</td>
          <td>${row.product || ''}</td>
          <td>${row.producttype || ''}</td>
          <td>${row.rate || ''}</td>
          <td>${row.description || ''}</td>
          <td>${row.contact || ''}</td>
          <td>${row.mail || ''}</td>
          <td>
            <button onclick="editRow(${i}, ${JSON.stringify(row).replace(/"/g, '&quot;')})">Edit</button>
            <button onclick="deleteRow(${i})">Delete</button>
          </td>
        `;
        tbody.appendChild(tr);
      });
    }

    // Edit row
    function editRow(id, row) {
      document.getElementById('rowId').value = id;
      document.getElementById('companyname').value = row.companyname;
      document.getElementById('product').value = row.product;
      document.getElementById('producttype').value = row.producttype;
      document.getElementById('rate').value = row.rate;
      document.getElementById('description').value = row.description;
      document.getElementById('contact').value = row.contact;
      document.getElementById('mail').value = row.mail;
    }

    // Delete row
    function deleteRow(id) {
      if (confirm('Are you sure to delete this row?')) {
        google.script.run.withSuccessHandler(loadData).deleteData(id);
      }
    }

    // Clear form
    function clearForm() {
      document.getElementById('dataForm').reset();
      document.getElementById('rowId').value = '';
    }

    // Form submit
    document.getElementById('dataForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const id = document.getElementById('rowId').value;
      const rowData = {
        companyname: document.getElementById('companyname').value,
        product: document.getElementById('product').value,
        producttype: document.getElementById('producttype').value,
        rate: document.getElementById('rate').value,
        description: document.getElementById('description').value,
        contact: document.getElementById('contact').value,
        mail: document.getElementById('mail').value
      };
      if (id) {
        google.script.run.withSuccessHandler(loadData).updateData(parseInt(id), rowData);
      } else {
        google.script.run.withSuccessHandler(loadData).addData(rowData);
      }
      clearForm();
    });

    loadData();
  </script>
</body>
</html>
