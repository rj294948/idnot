<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RJ Company Products</title>
<style>
body {font-family: Arial; background: #f9f9f9; padding: 20px;}
table {border-collapse: collapse; width: 100%; background: white;}
th, td {border: 1px solid #ccc; padding: 8px; text-align: left;}
th {background: #007bff; color: white;}
button {padding: 5px 10px; border: none; cursor: pointer;}
.add, .update {background: #28a745; color: white; margin-top: 10px;}
.delete {background: #dc3545; color: white;}
.edit {background: #ffc107; color: black;}
input {padding: 6px; width: 100%; margin-top: 5px;}
</style>
</head>
<body>

<h2>ðŸ§¾ RJ Company Product Manager</h2>

<form id="dataForm">
  <input type="hidden" id="rowId">
  <label>Company Name:</label><input id="company_name"><br>
  <label>Product:</label><input id="product"><br>
  <label>Product Type:</label><input id="product_type"><br>
  <label>Rate:</label><input id="rate"><br>
  <label>Description:</label><input id="description"><br>
  <label>Contact:</label><input id="contact"><br>
  <label>Mail:</label><input id="mail"><br>
  <button type="button" class="add" onclick="addData()">Add Data</button>
  <button type="button" class="update" onclick="updateData()">Update Data</button>
</form>

<h3>ðŸ“‹ Records</h3>
<table id="dataTable">
  <thead>
    <tr>
      <th>#</th>
      <th>Company Name</th>
      <th>Product</th>
      <th>Product Type</th>
      <th>Rate</th>
      <th>Description</th>
      <th>Contact</th>
      <th>Mail</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
const SHEET_URL = "https://script.google.com/macros/s/AKfycby_H0WaVNgBZU-D0VUQs73YIXY4_OBPd-gPFoo2mTMatdg0lsQhjoRJ2uCKdLDRMse2/exec";

async function loadData() {
  try {
    const res = await fetch(SHEET_URL);
    const json = await res.json();

    if (!json.data || !Array.isArray(json.data)) {
      console.error("âŒ Data is not an array:", json);
      return;
    }

    const table = document.querySelector("#dataTable tbody");
    table.innerHTML = "";
    json.data.forEach((r, i) => {
      const row = `<tr>
        <td>${i+1}</td>
        <td>${r["company name"]||""}</td>
        <td>${r["product"]||""}</td>
        <td>${r["product type"]||""}</td>
        <td>${r["rate"]||""}</td>
        <td>${r["description"]||""}</td>
        <td>${r["contact"]||""}</td>
        <td>${r["mail"]||""}</td>
        <td>
          <button class="edit" onclick='editRow(${i}, ${JSON.stringify(r)})'>Edit</button>
          <button class="delete" onclick='deleteRow(${i})'>Delete</button>
        </td>
      </tr>`;
      table.insertAdjacentHTML("beforeend", row);
    });
  } catch (err) {
    console.error("âŒ Load Error:", err);
  }
}

async function addData() {
  const form = new FormData();
  form.append("action", "add");
  ["company_name","product","product_type","rate","description","contact","mail"].forEach(id=>{
    form.append(id, document.getElementById(id).value);
  });
  await fetch(SHEET_URL, { method:"POST", body:form });
  loadData();
}

function editRow(index, r) {
  document.getElementById("rowId").value = index;
  for (let key in r) {
    let id = key.replace(" ", "_");
    if (document.getElementById(id)) document.getElementById(id).value = r[key];
  }
}

async function updateData() {
  const id = document.getElementById("rowId").value;
  if (id === "") return alert("Select a row to edit!");
  const form = new FormData();
  form.append("action", "edit");
  form.append("id", id);
  ["company_name","product","product_type","rate","description","contact","mail"].forEach(id=>{
    form.append(id, document.getElementById(id).value);
  });
  await fetch(SHEET_URL, { method:"POST", body:form });
  loadData();
}

async function deleteRow(id) {
  const form = new FormData();
  form.append("action", "delete");
  form.append("id", id);
  await fetch(SHEET_URL, { method:"POST", body:form });
  loadData();
}

loadData();
</script>

</body>
</html>
