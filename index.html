<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ID Not Table</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; }
  table { border-collapse: collapse; width: 100%; margin-top: 20px; }
  th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
  th { background-color: #f2f2f2; }
  input { padding: 5px; width: 100%; box-sizing: border-box; }
  button { padding: 5px 10px; margin: 2px; cursor: pointer; }
</style>
</head>
<body>

<h2>Company Products Table</h2>

<!-- Form to add new data -->
<div>
  <input type="text" id="companyName" placeholder="Company Name">
  <input type="text" id="product" placeholder="Product">
  <input type="text" id="productType" placeholder="Product Type">
  <input type="text" id="rate" placeholder="Rate">
  <input type="text" id="description" placeholder="Description">
  <input type="text" id="contact" placeholder="Contact">
  <input type="email" id="mail" placeholder="Email">
  <button onclick="addRow()">Add</button>
</div>

<!-- Table to show data -->
<table>
  <thead>
    <tr>
      <th>Company Name</th>
      <th>Product</th>
      <th>Product Type</th>
      <th>Rate</th>
      <th>Description</th>
      <th>Contact</th>
      <th>Mail</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody id="tableBody"></tbody>
</table>

<script>
const API_URL = 'https://script.google.com/macros/s/AKfycby_H0WaVNgBZU-D0VUQs73YIXY4_OBPd-gPFoo2mTMatdg0lsQhjoRJ2uCKdLDRMse2/exec';

async function loadData() {
  try {
    const res = await fetch(`${API_URL}?action=getData`);
    const json = await res.json();
    if(json.status === 'success') {
      renderTable(json.data);
    } else {
      console.error('❌ Data not loaded', json);
    }
  } catch(err) {
    console.error('❌ Load Error:', err);
  }
}

function renderTable(data) {
  const tbody = document.getElementById('tableBody');
  tbody.innerHTML = '';
  data.forEach(row => {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td><input value="${row.companyName}" onchange="updateRow(${row.id}, 'companyName', this.value)"></td>
      <td><input value="${row.product}" onchange="updateRow(${row.id}, 'product', this.value)"></td>
      <td><input value="${row.productType}" onchange="updateRow(${row.id}, 'productType', this.value)"></td>
      <td><input value="${row.rate}" onchange="updateRow(${row.id}, 'rate', this.value)"></td>
      <td><input value="${row.description}" onchange="updateRow(${row.id}, 'description', this.value)"></td>
      <td><input value="${row.contact}" onchange="updateRow(${row.id}, 'contact', this.value)"></td>
      <td><input value="${row.mail}" onchange="updateRow(${row.id}, 'mail', this.value)"></td>
      <td>
        <button onclick="deleteRow(${row.id})">Delete</button>
      </td>
    `;
    tbody.appendChild(tr);
  });
}

// Add new row
async function addRow() {
  const data = {
    companyName: document.getElementById('companyName').value,
    product: document.getElementById('product').value,
    productType: document.getElementById('productType').value,
    rate: document.getElementById('rate').value,
    description: document.getElementById('description').value,
    contact: document.getElementById('contact').value,
    mail: document.getElementById('mail').value
  };
  try {
    const res = await fetch(API_URL, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ action: 'add', data })
    });
    const json = await res.json();
    console.log(json);
    loadData();
  } catch(err) {
    console.error('Add Error:', err);
  }
}

// Update single field
async function updateRow(id, field, value) {
  // Get full row data first
  const rowEl = Array.from(document.querySelectorAll(`#tableBody tr`)).find(tr => tr.querySelector(`input[value="${value}"]`));
  const inputs = rowEl.querySelectorAll('input');
  const data = {
    companyName: inputs[0].value,
    product: inputs[1].value,
    productType: inputs[2].value,
    rate: inputs[3].value,
    description: inputs[4].value,
    contact: inputs[5].value,
    mail: inputs[6].value
  };
  try {
    const res = await fetch(API_URL, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ action: 'update', id, data })
    });
    const json = await res.json();
    console.log(json);
    loadData();
  } catch(err) {
    console.error('Update Error:', err);
  }
}

// Delete row
async function deleteRow(id) {
  try {
    const res = await fetch(API_URL, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ action: 'delete', id })
    });
    const json = await res.json();
    console.log(json);
    loadData();
  } catch(err) {
    console.error('Delete Error:', err);
  }
}

// Initial load
loadData();
</script>

</body>
</html>
