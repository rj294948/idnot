<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Sheet Data Manager</title>
  <style>
    body { font-family: Arial; padding: 20px; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background-color: #f2f2f2; }
    input, button { padding: 6px; margin: 2px 0; width: 100%; }
    .form-container { max-width: 800px; margin: auto; }
    .actions button { margin-right: 5px; }
  </style>
</head>
<body>

  <h2>Google Sheet Data Manager</h2>

  <div class="form-container">
    <input type="hidden" id="rowId">
    <label>Company Name:</label>
    <input type="text" id="companyname">
    <label>Product:</label>
    <input type="text" id="product">
    <label>Product Type:</label>
    <input type="text" id="producttype">
    <label>Rate:</label>
    <input type="text" id="rate">
    <label>Description:</label>
    <input type="text" id="description">
    <label>Contact:</label>
    <input type="text" id="contact">
    <label>Mail:</label>
    <input type="text" id="mail">
    <button onclick="saveRow()">Save / Update</button>
  </div>

  <table id="dataTable">
    <thead>
      <tr>
        <th>#</th>
        <th>Company Name</th>
        <th>Product</th>
        <th>Product Type</th>
        <th>Rate</th>
        <th>Description</th>
        <th>Contact</th>
        <th>Mail</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

<script>
const API_URL = 'https://script.google.com/macros/s/AKfycby_H0WaVNgBZU-D0VUQs73YIXY4_OBPd-gPFoo2mTMatdg0lsQhjoRJ2uCKdLDRMse2/exec'; // replace with your script URL

// Load data from sheet
async function loadData() {
  try {
    const res = await fetch(`${API_URL}?action=getData`);
    const json = await res.json();
    const tbody = document.querySelector('#dataTable tbody');
    tbody.innerHTML = '';

    if(!json.data || !Array.isArray(json.data)) {
      alert('Data format error. Check Apps Script.');
      return;
    }

    json.data.forEach((row, index) => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${index + 1}</td>
        <td>${row.companyname || ''}</td>
        <td>${row.product || ''}</td>
        <td>${row.producttype || ''}</td>
        <td>${row.rate || ''}</td>
        <td>${row.description || ''}</td>
        <td>${row.contact || ''}</td>
        <td>${row.mail || ''}</td>
        <td class="actions">
          <button onclick='editRow(${row.id}, ${JSON.stringify(row)})'>Edit</button>
          <button onclick='deleteRow(${row.id})'>Delete</button>
        </td>
      `;
      tbody.appendChild(tr);
    });
  } catch (err) {
    console.error('Load Error:', err);
  }
}

// Edit a row
function editRow(id, row) {
  document.getElementById('rowId').value = id;
  document.getElementById('companyname').value = row.companyname || '';
  document.getElementById('product').value = row.product || '';
  document.getElementById('producttype').value = row.producttype || '';
  document.getElementById('rate').value = row.rate || '';
  document.getElementById('description').value = row.description || '';
  document.getElementById('contact').value = row.contact || '';
  document.getElementById('mail').value = row.mail || '';
}

// Save or update row
async function saveRow() {
  const id = document.getElementById('rowId').value;
  const data = {
    companyName: document.getElementById('companyname').value,
    product: document.getElementById('product').value,
    productType: document.getElementById('producttype').value,
    rate: document.getElementById('rate').value,
    description: document.getElementById('description').value,
    contact: document.getElementById('contact').value,
    mail: document.getElementById('mail').value
  };

  try {
    const action = id ? 'update' : 'add';
    const res = await fetch(API_URL, {
      method: 'POST',
      body: JSON.stringify({ action, id, data }),
      headers: { 'Content-Type': 'application/json' }
    });
    const json = await res.json();
    if(json.success) {
      alert(json.message);
      document.getElementById('rowId').value = '';
      document.querySelectorAll('input[type=text]').forEach(input => input.value = '');
      loadData();
    } else {
      alert('Error: ' + json.error);
    }
  } catch (err) {
    console.error('Save Error:', err);
  }
}

// Delete row
async function deleteRow(id) {
  if(!confirm('Are you sure you want to delete this record?')) return;

  try {
    const res = await fetch(API_URL, {
      method: 'POST',
      body: JSON.stringify({ action: 'delete', id }),
      headers: { 'Content-Type': 'application/json' }
    });
    const json = await res.json();
    if(json.success) {
      alert(json.message);
      loadData();
    } else {
      alert('Error: ' + json.error);
    }
  } catch (err) {
    console.error('Delete Error:', err);
  }
}

// Initial load
loadData();
</script>

</body>
</html>
