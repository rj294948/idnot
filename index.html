<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ID Not - Products</title>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
  table { border-collapse: collapse; width: 100%; background: #fff; }
  th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
  th { background: #eee; }
  input { width: 100%; padding: 5px; box-sizing: border-box; }
  button { padding: 5px 10px; margin: 2px; cursor: pointer; }
</style>
</head>
<body>

<h2>Product List</h2>

<table id="productTable">
  <thead>
    <tr>
      <th>Company Name</th>
      <th>Product</th>
      <th>Product Type</th>
      <th>Rate</th>
      <th>Description</th>
      <th>Contact</th>
      <th>Mail</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<h3>Add New Product</h3>
<div>
  <input type="text" id="companyName" placeholder="Company Name">
  <input type="text" id="product" placeholder="Product">
  <input type="text" id="productType" placeholder="Product Type">
  <input type="number" id="rate" placeholder="Rate">
  <input type="text" id="description" placeholder="Description">
  <input type="text" id="contact" placeholder="Contact">
  <input type="email" id="mail" placeholder="Mail">
  <button onclick="addData()">Add Product</button>
</div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycby_H0WaVNgBZU-D0VUQs73YIXY4_OBPd-gPFoo2mTMatdg0lsQhjoRJ2uCKdLDRMse2/exec";

// Load data from sheet
async function loadData() {
  try {
    const res = await fetch(`${SCRIPT_URL}?action=getAll`);
    const json = await res.json();
    if (Array.isArray(json.data)) {
      renderTable(json.data);
    } else {
      console.error("❌ Data is not an array:", json);
    }
  } catch (err) {
    console.error("❌ Load Error:", err);
  }
}

// Render table rows
function renderTable(data) {
  const tbody = document.querySelector("#productTable tbody");
  tbody.innerHTML = "";
  data.forEach((row, index) => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td><input type="text" value="${row.CompanyName || ''}" data-index="${index}" data-field="CompanyName"></td>
      <td><input type="text" value="${row.Product || ''}" data-index="${index}" data-field="Product"></td>
      <td><input type="text" value="${row.ProductType || ''}" data-index="${index}" data-field="ProductType"></td>
      <td><input type="number" value="${row.Rate || ''}" data-index="${index}" data-field="Rate"></td>
      <td><input type="text" value="${row.Description || ''}" data-index="${index}" data-field="Description"></td>
      <td><input type="text" value="${row.Contact || ''}" data-index="${index}" data-field="Contact"></td>
      <td><input type="email" value="${row.Mail || ''}" data-index="${index}" data-field="Mail"></td>
      <td>
        <button onclick="saveRow(${index})">Save</button>
        <button onclick="deleteRow(${index})">Delete</button>
      </td>
    `;
    tbody.appendChild(tr);
  });
}

// Add new data
async function addData() {
  const data = {
    CompanyName: document.getElementById("companyName").value,
    Product: document.getElementById("product").value,
    ProductType: document.getElementById("productType").value,
    Rate: document.getElementById("rate").value,
    Description: document.getElementById("description").value,
    Contact: document.getElementById("contact").value,
    Mail: document.getElementById("mail").value
  };
  try {
    const res = await fetch(SCRIPT_URL, {
      method: "POST",
      body: JSON.stringify({ action: "add", data }),
      headers: { "Content-Type": "application/json" }
    });
    const result = await res.json();
    if (result.status === "success") loadData();
    else console.error("Add Error:", result);
  } catch (err) {
    console.error("Add Error:", err);
  }
}

// Save edited row
async function saveRow(index) {
  const rowInputs = document.querySelectorAll(`[data-index="${index}"]`);
  const updatedData = {};
  rowInputs.forEach(input => {
    updatedData[input.dataset.field] = input.value;
  });
  try {
    const res = await fetch(SCRIPT_URL, {
      method: "POST",
      body: JSON.stringify({ action: "edit", index, data: updatedData }),
      headers: { "Content-Type": "application/json" }
    });
    const result = await res.json();
    if (result.status === "success") loadData();
    else console.error("Save Error:", result);
  } catch (err) {
    console.error("Save Error:", err);
  }
}

// Delete row
async function deleteRow(index) {
  if (!confirm("Are you sure to delete this row?")) return;
  try {
    const res = await fetch(SCRIPT_URL, {
      method: "POST",
      body: JSON.stringify({ action: "delete", index }),
      headers: { "Content-Type": "application/json" }
    });
    const result = await res.json();
    if (result.status === "success") loadData();
    else console.error("Delete Error:", result);
  } catch (err) {
    console.error("Delete Error:", err);
  }
}

// Initial load
loadData();
</script>

</body>
</html>
