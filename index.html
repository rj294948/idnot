<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Sheet CRUD</title>
<style>
  table {border-collapse: collapse; width: 100%;}
  th, td {border: 1px solid #ccc; padding: 8px;}
  th {background: #f0f0f0;}
  input {width: 100%;}
  button {margin: 2px;}
</style>
</head>
<body>

<h2>Company Products</h2>
<table id="dataTable">
  <thead>
    <tr>
      <th>Company Name</th>
      <th>Product</th>
      <th>Product Type</th>
      <th>Rate</th>
      <th>Description</th>
      <th>Contact</th>
      <th>Mail</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<h3>Add New Row</h3>
<input id="CompanyName" placeholder="Company Name">
<input id="Product" placeholder="Product">
<input id="ProductType" placeholder="Product Type">
<input id="Rate" placeholder="Rate">
<input id="Description" placeholder="Description">
<input id="Contact" placeholder="Contact">
<input id="Mail" placeholder="Mail">
<button onclick="addData()">Add</button>

<script>
const API_URL = 'https://script.google.com/macros/s/AKfycby_H0WaVNgBZU-D0VUQs73YIXY4_OBPd-gPFoo2mTMatdg0lsQhjoRJ2uCKdLDRMse2/exec';
const CORS_PROXY = 'https://corsproxy.io/?';

let tableBody = document.querySelector("#dataTable tbody");

async function loadData() {
  try {
    const res = await fetch(`${CORS_PROXY}${API_URL}?action=getAll`);
    const json = await res.json();
    const data = json.data;
    tableBody.innerHTML = "";
    data.forEach(row => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td><input value="${row.CompanyName || ''}"></td>
        <td><input value="${row.Product || ''}"></td>
        <td><input value="${row.ProductType || ''}"></td>
        <td><input value="${row.Rate || ''}"></td>
        <td><input value="${row.Description || ''}"></td>
        <td><input value="${row.Contact || ''}"></td>
        <td><input value="${row.Mail || ''}"></td>
        <td>
          <button onclick='saveRow(${row.id}, this)'>Save</button>
          <button onclick='deleteRow(${row.id})'>Delete</button>
        </td>
      `;
      tableBody.appendChild(tr);
    });
  } catch(e) {
    console.error("‚ùå Load Error:", e);
  }
}

async function addData() {
  const params = {
    action: "add",
    CompanyName: document.getElementById("CompanyName").value,
    Product: document.getElementById("Product").value,
    ProductType: document.getElementById("ProductType").value,
    Rate: document.getElementById("Rate").value,
    Description: document.getElementById("Description").value,
    Contact: document.getElementById("Contact").value,
    Mail: document.getElementById("Mail").value
  };
  try {
    const query = new URLSearchParams(params).toString();
    await fetch(`${CORS_PROXY}${API_URL}?${query}`);
    loadData();
  } catch(e) { console.error("Add Error:", e); }
}

async function saveRow(id, btn) {
  const tr = btn.closest("tr");
  const inputs = tr.querySelectorAll("input");
  const params = {
    action: "edit",
    id: id,
    CompanyName: inputs[0].value,
    Product: inputs[1].value,
    ProductType: inputs[2].value,
    Rate: inputs[3].value,
    Description: inputs[4].value,
    Contact: inputs[5].value,
    Mail: inputs[6].value
  };
  try {
    const query = new URLSearchParams(params).toString();
    await fetch(`${CORS_PROXY}${API_URL}?${query}`);
    loadData();
  } catch(e) { console.error("Save Error:", e); }
}

async function deleteRow(id) {
  if(!confirm("Delete this row?")) return;
  try {
    const query = new URLSearchParams({action:"delete", id:id}).toString();
    await fetch(`${CORS_PROXY}${API_URL}?${query}`);
    loadData();
  } catch(e) { console.error("Delete Error:", e); }
}

loadData();
</script>
</body>
</html>
