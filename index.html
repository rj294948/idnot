<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>RJ Data Manager</title>
  <style>
    body { font-family: Arial; margin: 20px; background: #f8f9fa; }
    h2 { color: #333; }
    table { width: 100%; border-collapse: collapse; margin-top: 15px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    th { background: #007bff; color: white; }
    button { padding: 5px 10px; cursor: pointer; border: none; border-radius: 4px; }
    .addBtn { background: #28a745; color: #fff; }
    .editBtn { background: #ffc107; }
    .deleteBtn { background: #dc3545; color: #fff; }
    form { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; }
    input { padding: 8px; border: 1px solid #ccc; border-radius: 4px; }
  </style>
</head>
<body>
  <h2>üìä Company Product Management</h2>

  <form id="dataForm">
    <input type="hidden" id="row" />
    <input type="text" id="company name" placeholder="Company Name" required />
    <input type="text" id="product" placeholder="Product" required />
    <input type="text" id="product type" placeholder="Product Type" />
    <input type="text" id="rate" placeholder="Rate" />
    <input type="text" id="description" placeholder="Description" />
    <input type="text" id="contact" placeholder="Contact" />
    <input type="email" id="mail" placeholder="Mail" />
    <button type="submit" class="addBtn">Add / Update</button>
  </form>

  <table id="dataTable">
    <thead>
      <tr>
        <th>Row</th>
        <th>Company</th>
        <th>Product</th>
        <th>Product Type</th>
        <th>Rate</th>
        <th>Description</th>
        <th>Contact</th>
        <th>Mail</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    const SHEET_URL = "https://script.google.com/macros/s/AKfycby_H0WaVNgBZU-D0VUQs73YIXY4_OBPd-gPFoo2mTMatdg0lsQhjoRJ2uCKdLDRMse2/exec";

    async function loadData() {
      try {
        const res = await fetch(`${SHEET_URL}?action=getAll`);
        const data = await res.json();
        const tbody = document.querySelector("#dataTable tbody");
        tbody.innerHTML = "";

        data.data.forEach((row, index) => {
          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td>${index + 2}</td>
            <td>${row["company name"] || ""}</td>
            <td>${row["product"] || ""}</td>
            <td>${row["product type"] || ""}</td>
            <td>${row["rate"] || ""}</td>
            <td>${row["description"] || ""}</td>
            <td>${row["contact"] || ""}</td>
            <td>${row["mail"] || ""}</td>
            <td>
              <button class="editBtn" onclick='editRow(${index + 2}, ${JSON.stringify(row)})'>‚úèÔ∏è</button>
              <button class="deleteBtn" onclick='deleteRow(${index + 2})'>üóëÔ∏è</button>
            </td>`;
          tbody.appendChild(tr);
        });
      } catch (err) {
        console.error("‚ùå Load Error:", err);
      }
    }

    document.getElementById("dataForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const row = document.getElementById("row").value;
      const data = {
        "company name": document.getElementById("company name").value,
        "product": document.getElementById("product").value,
        "product type": document.getElementById("product type").value,
        "rate": document.getElementById("rate").value,
        "description": document.getElementById("description").value,
        "contact": document.getElementById("contact").value,
        "mail": document.getElementById("mail").value
      };
      const action = row ? "edit" : "add";
      const params = new URLSearchParams({ action, row, ...data });

      await fetch(`${SHEET_URL}?${params}`);
      e.target.reset();
      document.getElementById("row").value = "";
      loadData();
    });

    async function deleteRow(row) {
      if (!confirm("Are you sure to delete?")) return;
      await fetch(`${SHEET_URL}?action=delete&row=${row}`);
      loadData();
    }

    function editRow(row, data) {
      document.getElementById("row").value = row;
      for (const key in data) {
        if (document.getElementById(key)) document.getElementById(key).value = data[key];
      }
    }

    loadData();
  </script>
</body>
</html>
