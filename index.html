<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>CRUD App</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    table { border-collapse: collapse; width: 100%; margin-top: 20px; }
    th, td { border: 1px solid #ddd; padding: 8px; }
    th { background-color: #f2f2f2; text-align: left; }
    input { padding: 5px; width: 100%; }
    button { padding: 5px 10px; margin: 2px; }
  </style>
</head>
<body>
  <h2>Google Sheet CRUD App</h2>
  
  <h3>Add / Edit Row</h3>
  <form id="rowForm">
    <input type="hidden" id="rowId">
    <input type="text" id="companyname" placeholder="Company Name" required>
    <input type="text" id="product" placeholder="Product" required>
    <input type="text" id="producttype" placeholder="Product Type" required>
    <input type="text" id="rate" placeholder="Rate">
    <input type="text" id="description" placeholder="Description">
    <input type="text" id="contact" placeholder="Contact">
    <input type="email" id="mail" placeholder="Mail">
    <button type="submit">Save</button>
    <button type="button" onclick="clearForm()">Clear</button>
  </form>

  <h3>Data Table</h3>
  <table id="dataTable">
    <thead>
      <tr>
        <th>#</th>
        <th>Company Name</th>
        <th>Product</th>
        <th>Product Type</th>
        <th>Rate</th>
        <th>Description</th>
        <th>Contact</th>
        <th>Mail</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    function loadData() {
      google.script.run.withSuccessHandler(renderTable).getAllData();
    }

    function renderTable(data) {
      const tbody = document.querySelector('#dataTable tbody');
      tbody.innerHTML = '';
      data.forEach((row, index) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${index + 1}</td>
          <td>${row.companyname}</td>
          <td>${row.product}</td>
          <td>${row.producttype}</td>
          <td>${row.rate}</td>
          <td>${row.description}</td>
          <td>${row.contact}</td>
          <td>${row.mail}</td>
          <td>
            <button onclick="editRow(${index}, ${JSON.stringify(row)})">Edit</button>
            <button onclick="deleteRow(${index})">Delete</button>
          </td>
        `;
        tbody.appendChild(tr);
      });
    }

    function editRow(id, rowData) {
      document.getElementById('rowId').value = id;
      document.getElementById('companyname').value = rowData.companyname;
      document.getElementById('product').value = rowData.product;
      document.getElementById('producttype').value = rowData.producttype;
      document.getElementById('rate').value = rowData.rate;
      document.getElementById('description').value = rowData.description;
      document.getElementById('contact').value = rowData.contact;
      document.getElementById('mail').value = rowData.mail;
    }

    function deleteRow(id) {
      if(confirm('Are you sure to delete?')) {
        google.script.run.withSuccessHandler(loadData).deleteRow(id);
      }
    }

    function clearForm() {
      document.getElementById('rowForm').reset();
      document.getElementById('rowId').value = '';
    }

    document.getElementById('rowForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const rowId = document.getElementById('rowId').value;
      const rowData = {
        companyname: document.getElementById('companyname').value,
        product: document.getElementById('product').value,
        producttype: document.getElementById('producttype').value,
        rate: document.getElementById('rate').value,
        description: document.getElementById('description').value,
        contact: document.getElementById('contact').value,
        mail: document.getElementById('mail').value
      };
      if(rowId === '') {
        google.script.run.withSuccessHandler(function(){ loadData(); clearForm(); }).addRow(rowData);
      } else {
        google.script.run.withSuccessHandler(function(){ loadData(); clearForm(); }).updateRow(parseInt(rowId), rowData);
      }
    });

    // Load data on page load
    window.onload = loadData;
  </script>
</body>
</html>
