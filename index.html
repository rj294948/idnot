<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firestore to Facebook - Manual Poster</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background: #1e3a8a; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; background: white; border-radius: 15px; padding: 25px; }
        .header { background: linear-gradient(135deg, #7c3aed, #8b5cf6); color: white; padding: 25px; border-radius: 10px; text-align: center; margin-bottom: 20px; }
        .btn { padding: 12px 20px; border: none; border-radius: 8px; cursor: pointer; margin: 5px; font-weight: bold; }
        .btn-copy { background: #10b981; color: white; }
        .btn-next { background: #3b82f6; color: white; }
        .product-card { border: 2px solid #e2e8f0; padding: 20px; margin: 15px 0; border-radius: 10px; background: #f8fafc; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìã MANUAL FACEBOOK POSTER</h1>
            <p>Copy & Paste Method - 100% Working</p>
        </div>

        <div id="notification"></div>
        <div id="products-container"></div>
        
        <div style="text-align: center; margin-top: 30px;">
            <button class="btn btn-next" onclick="loadNextProduct()">‚û°Ô∏è Next Product</button>
        </div>
    </div>

    <script type="module">
        import { 
            db, 
            collection, 
            getDocs, 
            doc, 
            updateDoc,
            serverTimestamp
        } from './firebase-config.js';

        let products = [];
        let currentIndex = 0;

        // Load products
        async function loadProducts() {
            try {
                const querySnapshot = await getDocs(collection(db, "products"));
                products = [];
                querySnapshot.forEach((doc) => {
                    products.push({ id: doc.id, ...doc.data() });
                });
                
                // Filter only unpublished products
                products = products.filter(p => !p.posted_to_facebook);
                
                if (products.length > 0) {
                    showProduct(0);
                } else {
                    document.getElementById('products-container').innerHTML = `
                        <div style="text-align: center; padding: 40px; color: #666;">
                            <h3>‚úÖ All products posted!</h3>
                            <p>No pending products found.</p>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Error:', error);
            }
        }

        // Show product
        function showProduct(index) {
            if (index >= products.length) {
                document.getElementById('products-container').innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #666;">
                        <h3>üéâ All done!</h3>
                        <p>All products processed.</p>
                    </div>
                `;
                return;
            }

            const product = products[index];
            const message = generateFacebookMessage(product);
            
            document.getElementById('products-container').innerHTML = `
                <div class="product-card">
                    <h3>üì¶ Product ${index + 1} of ${products.length}</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
                        <div>
                            <h4>Product Details:</h4>
                            <p><strong>Name:</strong> ${product.stone_name}</p>
                            <p><strong>Price:</strong> ‚Çπ${product.price || 'N/A'} ${product.price_unit || ''}</p>
                            <p><strong>Category:</strong> ${product.category || ''}</p>
                        </div>
                        <div>
                            <h4>Facebook Post Text:</h4>
                            <textarea id="post-text" rows="8" style="width: 100%; padding: 15px; border: 2px solid #3b82f6; border-radius: 8px; font-family: Arial; font-size: 14px;">${message}</textarea>
                            <button class="btn btn-copy" onclick="copyToClipboard()" style="width: 100%; margin-top: 10px;">
                                üìã Copy Text to Clipboard
                            </button>
                        </div>
                    </div>
                    <div style="background: #fef3c7; padding: 15px; border-radius: 8px; margin-top: 15px;">
                        <h4>üìù Instructions:</h4>
                        <ol>
                            <li>Click "Copy Text to Clipboard"</li>
                            <li>Go to <a href="https://facebook.com/950920808095297" target="_blank">Your Facebook Page</a></li>
                            <li>Paste the text and post</li>
                            <li>Come back and click "Next Product"</li>
                        </ol>
                    </div>
                    <div style="text-align: center; margin-top: 20px;">
                        <button class="btn" onclick="markAsPosted(${index})" style="background: #10b981; color: white;">
                            ‚úÖ Mark as Posted
                        </button>
                    </div>
                </div>
            `;
            
            currentIndex = index;
        }

        // Generate Facebook message
        function generateFacebookMessage(product) {
            return `üèõÔ∏è ${product.stone_name}

üí∞ Price: ‚Çπ${product.price || 'Contact for Price'} ${product.price_unit || ''}
üì¶ Category: ${product.category || 'Natural Stone'}

${product.description || 'Premium quality natural stone from Rajasthan. Perfect for construction, flooring, and decoration projects.'}

üè™ RJ Multi Stone Hub
üìû Contact for Bulk Orders & Pricing
üöö Delivery Available
‚úÖ Quality Guaranteed

#RajasthanStones #NaturalStone #${(product.category || 'Stone').replace(/\s+/g, '')} #${product.stone_name.replace(/\s+/g, '')} #RJMultiStoneHub`;
        }

        // Copy to clipboard
        function copyToClipboard() {
            const textarea = document.getElementById('post-text');
            textarea.select();
            document.execCommand('copy');
            
            showNotification('‚úÖ Text copied to clipboard! Now paste it on Facebook.', 'success');
        }

        // Mark as posted
        async function markAsPosted(index) {
            const product = products[index];
            
            try {
                await updateDoc(doc(db, "products", product.id), {
                    posted_to_facebook: true,
                    posted_at: serverTimestamp(),
                    post_method: 'Manual Copy-Paste'
                });
                
                showNotification('‚úÖ Product marked as posted!', 'success');
                loadNextProduct();
                
            } catch (error) {
                showNotification('‚ùå Error updating product: ' + error.message, 'error');
            }
        }

        // Load next product
        function loadNextProduct() {
            showProduct(currentIndex + 1);
        }

        // Show notification
        function showNotification(message, type) {
            const notification = document.getElementById('notification');
            notification.innerHTML = message;
            notification.style.cssText = `
                padding: 15px; 
                margin: 15px 0; 
                border-radius: 8px; 
                background: ${type === 'success' ? '#dcfce7' : '#fecaca'};
                color: ${type === 'success' ? '#166534' : '#991b1b'};
                border: 2px solid ${type === 'success' ? '#bbf7d0' : '#fca5a5'};
            `;
            
            setTimeout(() => {
                notification.innerHTML = '';
                notification.style.cssText = '';
            }, 5000);
        }

        // Initialize
        loadProducts();
    </script>
</body>
</html>
