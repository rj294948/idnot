<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RJ Sheet Data Manager</title>
<style>
body { font-family: Arial; background: #f8f9fa; padding: 20px; }
h2 { color: #007bff; }
input { margin: 5px; padding: 8px; width: 200px; }
button { margin: 5px; padding: 8px 12px; cursor: pointer; }
table { border-collapse: collapse; width: 100%; margin-top: 20px; background: #fff; }
th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
th { background: #007bff; color: white; }
</style>
</head>
<body>

<h2>üìã RJ Product Records</h2>

<div>
  <input id="company" placeholder="Company Name">
  <input id="product" placeholder="Product">
  <input id="ptype" placeholder="Product Type">
  <input id="rate" placeholder="Rate">
  <input id="desc" placeholder="Description">
  <input id="contact" placeholder="Contact">
  <input id="mail" placeholder="Mail">
  <button onclick="addData()">Add</button>
</div>

<table id="dataTable">
  <thead>
    <tr>
      <th>Company Name</th>
      <th>Product</th>
      <th>Product Type</th>
      <th>Rate</th>
      <th>Description</th>
      <th>Contact</th>
      <th>Mail</th>
      <th>Action</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycby_H0WaVNgBZU-D0VUQs73YIXY4_OBPd-gPFoo2mTMatdg0lsQhjoRJ2uCKdLDRMse2/exec";

// ‚úÖ Load Data
async function loadData() {
  try {
    const res = await fetch(`${API_URL}?action=getAll`);
    const text = await res.text(); // first get raw
    let data;
    try { data = JSON.parse(text); } 
    catch(e) { console.error("Not valid JSON:", text); return; }

    if (!Array.isArray(data)) {
      console.error("‚ùå Data is not an array:", data);
      return;
    }

    const tbody = document.querySelector("#dataTable tbody");
    tbody.innerHTML = "";
    data.forEach(r => {
      tbody.innerHTML += `
        <tr>
          <td>${r["company name"] || ""}</td>
          <td>${r["product"] || ""}</td>
          <td>${r["product type"] || ""}</td>
          <td>${r["rate"] || ""}</td>
          <td>${r["description"] || ""}</td>
          <td>${r["contact"] || ""}</td>
          <td>${r["mail"] || ""}</td>
          <td>
            <button onclick='editRow("${r["company name"]}")'>‚úèÔ∏è</button>
            <button onclick='deleteRow("${r["company name"]}")'>üóëÔ∏è</button>
          </td>
        </tr>`;
    });
  } catch (err) {
    console.error("‚ùå Load Error:", err);
  }
}

// ‚úÖ Add Row
async function addData() {
  const data = {
    action: "add",
    "company name": company.value.trim(),
    product: product.value,
    "product type": ptype.value,
    rate: rate.value,
    description: desc.value,
    contact: contact.value,
    mail: mail.value
  };

  await fetch(API_URL, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(data)
  });
  loadData();
}

// ‚úÖ Edit Row
async function editRow(name) {
  const data = {
    action: "edit",
    "company name": name,
    product: prompt("New product?"),
    "product type": prompt("New product type?"),
    rate: prompt("New rate?"),
    description: prompt("New description?"),
    contact: prompt("New contact?"),
    mail: prompt("New mail?")
  };

  await fetch(API_URL, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(data)
  });
  loadData();
}

// ‚úÖ Delete Row
async function deleteRow(name) {
  if (!confirm("Are you sure to delete this company?")) return;
  const data = { action: "delete", "company name": name };

  await fetch(API_URL, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(data)
  });
  loadData();
}

loadData();
</script>

</body>
</html>
